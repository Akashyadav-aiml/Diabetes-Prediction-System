<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make Prediction - Diabetes System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='chatbot.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <h1>üè• Diabetes Prediction System</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="{{ url_for('home') }}">Home</a></li>
                <li><a href="{{ url_for('predict') }}" class="active">Predict</a></li>
                <li><a href="{{ url_for('history') }}">History</a></li>
                <li><a href="{{ url_for('about') }}">About</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <section class="prediction-section">
            <h2>Patient Data Input</h2>
            <p class="subtitle">Enter the following 8 medical indicators to get a prediction</p>

            <form id="predictionForm" class="prediction-form">
                <div class="form-grid">
                    {% for feature in features %}
                    <div class="form-group">
                        <label for="{{ feature.lower().replace(' ', '_') }}">
                            {{ feature }}
                            <span class="field-number">({{ loop.index }}/{{ features|length }})</span>
                        </label>
                        <input 
                            type="number" 
                            id="{{ feature.lower().replace(' ', '_') }}" 
                            name="{{ feature.lower().replace(' ', '_') }}" 
                            step="0.1" 
                            min="0" 
                            required
                            placeholder="Enter value"
                            class="form-input"
                        >
                    </div>
                    {% endfor %}
                </div>

                <button type="submit" class="btn btn-primary btn-large">Get Prediction</button>
                <a href="{{ url_for('history') }}" class="btn btn-secondary">View History</a>
            </form>

            <div id="loadingSpinner" class="hidden">
                <div class="spinner"></div>
                <p>Analyzing patient data...</p>
            </div>
        </section>

        <div id="resultContainer" class="result-container hidden">
            <div class="result-card">
                <div id="resultContent"></div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 Diabetes Prediction System</p>
    </footer>

    <script>
        const featureKeys = ['pregnancies', 'glucose', 'blood_pressure', 'skin_thickness', 'insulin', 'bmi', 'diabetes_pedigree_function', 'age'];

        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(document.getElementById('predictionForm'));
            
            // Show loading spinner
            document.getElementById('loadingSpinner').classList.remove('hidden');
            document.getElementById('resultContainer').classList.add('hidden');

            try {
                const response = await fetch('{{ url_for("predict") }}', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                document.getElementById('loadingSpinner').classList.add('hidden');

                if (response.ok && data.success) {
                    displayResult(data);
                } else {
                    displayError(data.error || 'Prediction failed');
                }
            } catch (error) {
                document.getElementById('loadingSpinner').classList.add('hidden');
                displayError('An error occurred: ' + error.message);
            }
        });

        function displayResult(data) {
            const resultHTML = `
                <h3 class="result-title">üîç Prediction Result</h3>
                
                <div class="prediction-result ${data.prediction === 1 ? 'diabetic' : 'non-diabetic'}">
                    <div class="prediction-status">
                        <span class="status-icon">${data.prediction === 1 ? '‚ö†Ô∏è' : '‚úÖ'}</span>
                        <h2>${data.prediction_text.toUpperCase()}</h2>
                    </div>
                    
                    <div class="confidence-meter">
                        <p>Confidence Score</p>
                        <div class="meter-bar">
                            <div class="meter-fill" style="width: ${Math.min(data.confidence_score * 100, 100)}%"></div>
                        </div>
                        <p class="confidence-value">${data.confidence_score.toFixed(4)}</p>
                    </div>
                </div>

                <div class="patient-data">
                    <h4>üìã Patient Data Summary</h4>
                    <div class="data-grid">
                        <div class="data-item">
                            <span class="data-label">Pregnancies:</span>
                            <span class="data-value">${data.patient_data.pregnancies}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Glucose:</span>
                            <span class="data-value">${data.patient_data.glucose}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">BloodPressure:</span>
                            <span class="data-value">${data.patient_data.blood_pressure}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">SkinThickness:</span>
                            <span class="data-value">${data.patient_data.skin_thickness}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Insulin:</span>
                            <span class="data-value">${data.patient_data.insulin}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">BMI:</span>
                            <span class="data-value">${data.patient_data.bmi}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">DiabetesPedigreeFunction:</span>
                            <span class="data-value">${data.patient_data.diabetes_pedigree_function}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Age:</span>
                            <span class="data-value">${data.patient_data.age}</span>
                        </div>
                    </div>
                </div>

                <div class="result-actions">
                    <a href="/results/${data.record_id}" class="btn btn-primary">View Full Results</a>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('predictionForm').reset(); document.getElementById('resultContainer').classList.add('hidden');">Make Another Prediction</button>
                </div>
            `;

            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('resultContainer').classList.remove('hidden');
        }

        function displayError(message) {
            const errorHTML = `
                <div class="alert alert-error">
                    <h3>‚ùå Error</h3>
                    <p>${message}</p>
                </div>
            `;

            document.getElementById('resultContent').innerHTML = errorHTML;
            document.getElementById('resultContainer').classList.remove('hidden');
        }
    </script>
    <script src="{{ url_for('static', filename='chatbot.js') }}"></script>
</body>
</html>
